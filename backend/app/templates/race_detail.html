{% extends "base.html" %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h1 class="h3 m-0">{{ race.race_id }}</h1>
    <div class="text-muted">{{ race.race_date.isoformat() }} • {{ race.race_timezone }}</div>
  </div>
  {% if staff %}
    <a class="btn btn-primary" href="/admin/races/{{ race.race_id }}/parts/new">Add race part</a>
  {% endif %}
</div>

<div class="d-flex gap-2 mb-3 flex-wrap">
  {% if staff %}
    <a class="btn btn-outline-secondary btn-sm" href="/api/race-parts.csv?race_id={{ race.race_id }}">Download race parts CSV</a>
    <a class="btn btn-outline-secondary btn-sm" href="/api/participants.csv?race_id={{ race.race_id }}">Download participants CSV</a>
    <a class="btn btn-outline-secondary btn-sm" href="/api/timing-events.csv?race_id={{ race.race_id }}">Download timing events CSV</a>
  {% endif %}
  {% if staff %}
    <a class="btn btn-outline-primary btn-sm" href="/admin/races/{{ race.race_id }}/participants/new">Add participant</a>
    <a class="btn btn-outline-primary btn-sm" href="/admin/races/{{ race.race_id }}/participants/upload">Upload participants CSV</a>
    {% if staff.role == "admin" %}
      <a class="btn btn-outline-danger btn-sm" href="/admin/races/{{ race.race_id }}/participants">Remove participant</a>
    {% endif %}
    {% if staff.role == "admin" %}
      <a class="btn btn-outline-success btn-sm" href="/admin/users/new?race_id={{ race.race_id }}">Create organizer account</a>
    {% endif %}
  {% endif %}
</div>

<h2 class="h5 mt-4">Race parts</h2>
<div class="list-group shadow-sm">
  {% for p in parts %}
    <div class="list-group-item">
      <div class="d-flex justify-content-between align-items-center gap-2">
        <div class="flex-grow-1">
          <div class="fw-semibold">
            <a href="/races/{{ race.race_id }}/parts/{{ p.race_part_id }}" class="text-decoration-none">{{ p.name }}</a>
          </div>
          <div class="small text-muted">ID: {{ p.race_part_id }} • Type: {{ p.time_event_type }}</div>
        </div>
        <div class="d-flex align-items-center gap-2">
          <span class="badge text-bg-secondary">{{ p.time_event_type }}</span>
          {% if staff and staff.role == "admin" and p.race_part_id != "OVERALL" %}
            <form method="post" action="/admin/races/{{ race.race_id }}/parts/{{ p.race_part_id }}/delete" onsubmit="return confirm('Remove race part {{ p.name }}? This will also remove its timing events and start times.');">
              <button class="btn btn-outline-danger btn-sm" type="submit">Remove</button>
            </form>
          {% endif %}
        </div>
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}
