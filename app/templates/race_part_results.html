{% extends "base.html" %}
{% block content %}
<h1>{{ race.race_id }} â€“ {{ race_part.race_part_id }}</h1>
<div class="card">
  <form method="get" action="/race/{{ race.race_id }}/part/{{ race_part.race_part_id }}">
    <label>
      Group filter (multi-select)
      <select name="group" multiple size="4">
        {% for group in groups %}
          <option value="{{ group }}" {% if group in group_filters %}selected{% endif %}>{{ group }}</option>
        {% endfor %}
      </select>
    </label>
    <label>
      Sex filter (multi-select)
      <select name="sex" multiple size="3">
        {% for sex in sexes %}
          <option value="{{ sex }}" {% if sex in sex_filters %}selected{% endif %}>{{ sex }}</option>
        {% endfor %}
      </select>
    </label>
    <div class="actions">
      <button class="ghost" type="submit">Apply Filters</button>
      <a class="button ghost" href="/race/{{ race.race_id }}/part/{{ race_part.race_part_id }}">Clear Filters</a>
    </div>
  </form>
</div>
<div class="card">
  <div class="actions">
    {% if user and (user.role == "admin" or race.race_id in user.race_ids) and not race_part.is_overall %}
      <a class="button" href="/race/{{ race.race_id }}/part/{{ race_part.race_part_id }}/manage/timing-events">Manage Timing Events</a>
      <a class="button" href="/race/{{ race.race_id }}/part/{{ race_part.race_part_id }}/submit-start">Submit Start Times</a>
      <a class="button" href="/race/{{ race.race_id }}/part/{{ race_part.race_part_id }}/submit-end">Submit End Times</a>
      <a class="button" href="/race/{{ race.race_id }}/part/{{ race_part.race_part_id }}/submit-duration">Submit Durations</a>
    {% endif %}
  </div>
</div>
<div class="card">
  <table class="table">
    <thead>
      <tr>
        <th>Bib</th>
        <th>Name</th>
        <th>Group</th>
        <th>Time</th>
        {% if race_part.is_overall %}
          {% for part in parts if not part.is_overall %}
            <th>{{ part.race_part_id }}</th>
          {% endfor %}
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr>
        <td>{{ row.bib }}</td>
        <td>{{ row.name }}</td>
        <td>{{ row.group }}</td>
        <td>{{ row.duration }}</td>
        {% if race_part.is_overall %}
          {% for part in parts if not part.is_overall %}
            <td>{{ row.parts[part.race_part_id] }}</td>
          {% endfor %}
        {% endif %}
      </tr>
      {% else %}
      <tr>
        <td colspan="6" class="small">No results yet.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script>
  setInterval(() => {
    window.location.reload();
  }, 5000);
</script>
{% endblock %}
